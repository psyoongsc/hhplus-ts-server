# 요구사항 분석

# 주제: e-커머스

## 기능적 요구사항

(어떤 기능을 제공할 수 있어야 하는가?)

- 상품 주문에 필요한 메뉴 정보들을 구성하고 조회가 가능해야 한다.
    - 상품 주문에 필요한 정보를 요청 시에 리스트 형태로 전달해주어야 한다.
    - 상품 리스트의 각 항목에 포함되어야 할 내용: **상품ID, 상품명, (조회 당시)재고, 가격**
- 사용자는 상품을 여러개 선택해 주문할 수 있고, 미리 충전한 잔액을 이용한다.
    - 여러개 상품을 선택하여 주문 할 수 있으려면 주문할 상품의 정보를 리스트 형식으로 넘겨 받아야 한다.
    - 주문할 상품 리스트의 각 항목에 포함되어야 할 내용: **구매자ID, 상품ID, 구매할 개수**
    - 미리 충전한 잔액을 사용하기 위해서 잔액 조회, 충전, 사용이 가능해야 한다.
    - 잔액을 통한 결제 성공시 잔액을 차감하여야 한다.
- 결제 성공 시 주문 정보를 데이터 플랫폼에 전달해야 한다.
    - 데이터 플랫폼이 어플리케이션 외부라는 가정만 지키면 된다.
- 선착순 쿠폰을 받을 수 있고 사용 시 전체 금액에서 쿠폰의 할인율만큼 할인한 금액만 결제한다.
    - 선착순 쿠폰을 받으려면 (조회 당시)발급 가능한 쿠폰 리스트 조회가 가능해야 한다.
    - 쿠폰 발급 요청 시 재고를 확인 후 성공/실패 여부를 반환해야 한다.
    - 주문 요청 시 사용 가능한 쿠폰이 있다면 주문 요청에 대한 총 금액 정보와 사용 가능한 쿠폰 정보를 전달한다.
    - 결제 시 쿠폰 사용 여부를 함께 전달 받아서 결제 금액을 확정하여 최종 금액으로 잔액을 차감하여 결제를 완료한다.
- 상품 주문 내역을 통해 최근 3일간 가장 많이 팔린 5개 상품을 정보를 제공한다.
    - 결제 완료 시 해당 내역을 저장하고, 해당 정보를 이용해 통계를 내어 추천한다.
    - 통계 산출 방안
        - SQL 쿼리로 조회 요청 시 그때 그때 통계를 산출하여 제공한다.

## 비기능적 요구사항

(성능, 확장성, 보안 관련한 추가적인 고려사항들을 고려할 수 있어야 한다.)

- (심화) 재고 관리에 문제 없도록 하여야 한다.
    - 결제 시 재고를 확인하여 주문에 대한 결제의 성공/실패 여부를 반환해야 한다.
- (심화) 동시성 이슈를 고려하여 구현해야 한다.
    - Mutex Lock 을 이용하여 인스턴스 내에서의 동시성 이슈를 해결한다.
- (심화) 다수의 인스턴스로 어플리케이션이 동작하더라도 기능에 문제가 없도록 작성해야 한다.
    - DB Lock 을 이용하여 다수의 인스턴스의 공유 자원에 대한 동시 접근을 제어를 해야 한다.
    

## 기능 리스트

| 서비스 분류 | 기능 분류 | 식별자 | 기능 상세 |
| --- | --- | --- | --- |
| 잔액 관리 | 잔액 조회 | B-1 | 사용자 식별자를 통해 사용자의 잔액을 조회할 수 있다. |
|  | 잔액 충전 | B-2 | 사용자 식별자를 통해 사용자의 잔액을 충전할 수 있다. |
|  | 잔액 사용 | B-3 | 결제 성공 시 결제 금액 만큼 해당 사용자의 잔액에서 차감한다. |
| 상품 관리 | 상품 조회 | P-1 | 주문 가능한 상품들에 대한 정보를 리스트 형식으로 전달한다. 
(응답 데이터 : 상품ID, 상품명, 재고량, 가격) |
|  | 선택 상품 조회 | P-2 | 상품 식별자를 통해 조회 시점에 상품 정보를 리스트 형식으로 전달한다. 
(응답 데이터 : 상품ID, 상품명, 재고량, 가격)  |
|  | 상품 판매 내역 조회 | P-3 | 상품 식별자를 통해 사용자가 결제하여 판매 완료 된 상품에 대한 내역을 전달한다. 
(응답 데이터 : 상품ID, 사용자ID, 구매량, 전체금액, 판매가격) |
|  | 인기 판매 상품 조회 | P-4 | 상품 판매 통계 테이블에서 구매한 상품을 조회시점에 대해 D-3 ~ D-1 기간 동안에 최대 판매량 5개에 해당하는 상품 리스트를 전달한다. 
(응답 데이터 : 순위, 상품명, 판매량, 판매액) |
|  | 상품 재고 추가 | P-5 | 상품 식별자를 통해 해당 상품의 재고를 추가한다. |
|  | 상품 재고 차감 | P-6 | 상품 식별자를 통해 해당 상품의 재고를 차감한다. |
| 주문/결제 관리 | 상품 주문 | O-1 | 주문 할 상품을 리스트 형식으로 전달받으며, 주문 요청 시점에서 재고가 남아있는지 확인 후 주문을 결제 전 상태로 주문서를 발행하고 해당 정보를 전달한다. 
주문 요청한 구매량이 재고량을 넘어가는 상품이 하나라도 있을 경우 주문은 실패한다.
(응답 데이터 : 주문ID, 사용자ID, 전체 가격) |
|  | 주문 취소 | O-2 | 주문 식별자를 통해서 해당 주문 요청을 취소한다. 취소 시 주문 했던 주문량 만큼 상품 재고를 다시 증가 시킨다. |
|  | 주문 결제 | O-3 | 주문 식별자와 사용할 쿠폰 정보를 전달 받으며, 쿠폰이 있다면 적용한 금액을 사용자에게서 사용 처리하고 잔액이 부족했다면 실패한다. 잔액이 정상적으로 사용 처리 되었다면 상품 잔고를 차감하고, 잔고가 부족했다면 실패한다.
결제 완료 시 해당 주문 식별자를 통해 주문 정보를 외부 플랫폼에 전달한다. |
| 쿠폰 관리 | 쿠폰 조회 | C-1 | 조회 시점에 사용자가 보유하지 않고, 재고가 있는 쿠폰 정보를 리스트 형식으로 전달한다. 
(응답 데이터 : 쿠폰ID, 쿠폰명, 쿠폰타입, 할인수치) |
|  | 쿠폰 지급 | C-2 | 쿠폰 식별자를 통해 지급 요청 시점에 재고가 있을 시, 사용자에게 지급 처리 한다. |
|  | 쿠폰 사용 | C-3 | 쿠폰 식별자를 통해 사용 시점에 잔여 쿠폰이 있을 경우 사용 처리 한다. |
|  | 보유 쿠폰 조회 | C-4 | 사용자 식별자를 통해 보유 중인 쿠폰 정보를 리스트 형식으로 전달한다. 
(응답 데이터 : 쿠폰ID, 쿠폰명, 쿠폰타입, 할인수치) |

### [분석/설계 문서]

시퀀스 다이어그램 : `docs/sequence_diagram.md`
ERD : `docs/erd.md`